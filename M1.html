<!doctype html>
<html>
	<head>
		<meta charset="UTF-8"> 
		<title>MyApp</title>
			<!--Any external file links, scripts/css gohere -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		
	</head>
	<style>
	
	      /* Optional: Makes the sample page fill the window. */
		html, body {
			height: 80%;
			margin: 0;
			padding: 0;
		}
	  
		body{
			font-family: Arial;
			background-image: url("http://www.siwallpaperhd.com/wp-content/uploads/2015/06/computer_theme_light_blue_wallpaper_hd_5.jpg");
		}
		
		#title{
		width:100%;
		text-align:center;
		margin-top:10px;
		margin-bottom:10px;
		}
		
		h1{
			text-align:center;
		}
		
		#map {
        height: 100%;
		}
	  
		#findRestButton{
		display:block;
		margin: 0 auto;
		font-family: "Comic Sans MS", cursive, sans-serif;
		
		}

	</style>
	<body>
		<!-- class="label label-info" -->
		<h1 id="title"><span class="label label-default"> MyRestaurantFinder </span></h1>
		<h1 id = "resultText">Click the button below to find a place to eat</h1>
		<br/>
		<div id = 'map'></div> <!-- map will go here-->
		<br/>
		<div id = "centered">
			<input type="button" class="btn btn-lg btn-info" value="Suggest a place!" id="findRestButton">
		</div>
	
		<script>
		
		//load restaurant locations and put them in locationList
		var locationList = [];
		
		//Creating the map
		var startPosition = {lat: 33.640, lng: -117.844}, //this is UCI's location
			markers = [], 
			map, 
			infowindow,
			contentString = 'UCI, where stuff happens';
		
		function initMap() {
			console.log('InitMap Called');
			map = new google.maps.Map(document.getElementById('map'), {
			zoom: 15,
			center: startPosition
			});	
			
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(function(position) {
				startPosition = {
					lat: position.coords.latitude,
					lng: position.coords.longitude
				};
				
				map.setCenter(startPosition);
				addMarkerAndInfo(startPosition, contentString);
				loadPlacesFromAPI(startPosition);
				}, function() {
					addMarkerAndInfo(startPosition, contentString);
					loadPlacesFromAPI(startPosition);
				});
				console.log("Geolocation Finished!")
			}
			map.setCenter(startPosition);
			addMarkerAndInfo(startPosition, contentString);
			loadPlacesFromAPI(startPosition);
			
		}
		
		function loadPlacesFromAPI(startPosition){
			console.log("loadPlaces called with a startPosition of: ", startPosition);
			var service = new google.maps.places.PlacesService(map);
			service.nearbySearch({
				location: startPosition,
				radius: 1500, //in meters
				type: ['food']
			}, callback)
		}
		
		function callback(data, status){
			if (status === google.maps.places.PlacesServiceStatus.OK){
				locationList = [];
				for (var i = 0; i < data.length ; i++){
					locationList.push([data[i].name,
										data[i].geometry.location]);
					console.log("Current array: ", locationList[i]);
				}
			}
		}
		
		
		//might only need to make function call on LAST marker when 'deleting' markers
		function setMapOnAll(map) {
			for (var i = 0; i < markers.length; i++) {
				markers[i].setMap(map);
			}
		}
		
		function addMarker(location){
		//dont forget to display the title
			var temp_marker = new google.maps.Marker({
				position: location,
				map:map
			});
			markers.push(temp_marker);
		}
		
		function addInfoWindow(contentString){
			infowindow = new google.maps.InfoWindow({
				content: contentString
			});
		}
			
		function addMarkerAndInfo(location, contentString){		
			console.log("Add Marker,Info w/ a start point of: ", location);
			//add new stuff
			addMarker(location);
			addInfoWindow(contentString);
			
			//make infoWindow popup when marker clicked
			markers[markers.length -1].addListener('click', function() {
				infowindow.open(map, markers[markers.length -1]);
			});
		}
			
		//inclusive rand function
		function getRandomInt(min, max) {
			return Math.floor(Math.random() * (max - min + 1)) + min;
		}
		
			
		function findRandRestaurant(){
			//get rand restaurant from locationList
			var temp = locationList[getRandomInt(0, locationList.length - 1 )];
			if (temp){
			
				//clear previous markers
				setMapOnAll(null);
				
				//add marker to map
				addMarkerAndInfo(
					temp[1], 	//location
					temp[0]		//contentstring
				);
				
				//center map to new location
				map.setCenter(temp[1]);
				
				//change result text
				$("#resultText").text("Try: " + temp[0]);
			}
			
			else{
				console.log('Nothing to  see here');
			}
		}
		
		
		$('#findRestButton').click(function(){
				findRandRestaurant();
		});
		
		
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBLi3xmU0ldG-blzINcr9D4RA7rl1Its4o&libraries=places&callback=initMap" async defer></script>	

	</body>
		
</html>